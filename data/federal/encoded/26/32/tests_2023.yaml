# Test cases for 26 USC § 32 (EITC) - Tax Year 2023
#
# These tests use TY 2023 for TAXSIM-35 compatibility (TAXSIM supports 1960-2023)
#
# Sources:
# - Statute: data/federal/statute/26/32/formula.cosilico
# - TY 2023 values: data/federal/guidance/irs/rp-22-38/eitc.yaml

variable: eitc
validator: taxsim-35
tax_year: 2023

test_cases:
  # ==========================================================================
  # PHASE-IN REGION - Credit = credit_percentage × earned_income
  # ==========================================================================

  - name: "Phase-in: 0 children, $5000 income"
    description: "Credit = 7.65% × $5,000 = $382.50"
    inputs:
      filing_status: single
      earned_income: 5000
      qualifying_children: 0
      age: 40
    expected:
      eitc: 382
    citations:
      - "§ 32(b)(1): credit_percentage = 7.65%"

  - name: "Phase-in: 1 child, $8000 income"
    description: "Credit = 34% × $8,000 = $2,720"
    inputs:
      filing_status: single
      earned_income: 8000
      qualifying_children: 1
      age: 30
    expected:
      eitc: 2720
    citations:
      - "§ 32(b)(1): credit_percentage = 34%"

  - name: "Phase-in: 2 children, $10000 income"
    description: "Credit = 40% × $10,000 = $4,000"
    inputs:
      filing_status: single
      earned_income: 10000
      qualifying_children: 2
      age: 35
    expected:
      eitc: 4000
    citations:
      - "§ 32(b)(1): credit_percentage = 40%"

  - name: "Phase-in: 3 children, $12000 income"
    description: "Credit = 45% × $12,000 = $5,400"
    inputs:
      filing_status: single
      earned_income: 12000
      qualifying_children: 3
      age: 35
    expected:
      eitc: 5400
    citations:
      - "§ 32(b)(1): credit_percentage = 45%"

  # ==========================================================================
  # PLATEAU REGION - Credit at maximum
  # Values from Rev. Proc. 2022-38
  # ==========================================================================

  - name: "Plateau: 0 children, max $600"
    inputs:
      filing_status: single
      earned_income: 9000
      qualifying_children: 0
      age: 40
    expected:
      eitc: 600
    citations:
      - "Rev. Proc. 2022-38, p.10: max = $600"

  - name: "Plateau: 1 child, max $3,995"
    inputs:
      filing_status: single
      earned_income: 15000
      qualifying_children: 1
      age: 30
    expected:
      eitc: 3995
    citations:
      - "Rev. Proc. 2022-38, p.10: max = $3,995"

  - name: "Plateau: 2 children, max $6,604"
    inputs:
      filing_status: single
      earned_income: 18000
      qualifying_children: 2
      age: 35
    expected:
      eitc: 6604
    citations:
      - "Rev. Proc. 2022-38, p.10: max = $6,604"

  - name: "Plateau: 3+ children, max $7,430"
    inputs:
      filing_status: single
      earned_income: 18000
      qualifying_children: 4
      age: 35
    expected:
      eitc: 7430
    citations:
      - "Rev. Proc. 2022-38, p.10: max = $7,430"
      - "§ 32(b)(1): 3+ children use same rate as 3"

  # ==========================================================================
  # PHASE-OUT REGION - Credit reduced
  # ==========================================================================

  - name: "Phase-out: 0 children, $12000 income"
    description: "$600 - 7.65% × ($12,000 - $9,800) = $432"
    inputs:
      filing_status: single
      earned_income: 12000
      qualifying_children: 0
      age: 40
    expected:
      eitc: 432
    citations:
      - "§ 32(a)(2)(B): phaseout_percentage = 7.65%"
      - "Rev. Proc. 2022-38: threshold = $9,800"

  - name: "Phase-out: 1 child, $30000 income"
    description: "$3,995 - 15.98% × ($30,000 - $21,560) = $2,647"
    inputs:
      filing_status: single
      earned_income: 30000
      qualifying_children: 1
      age: 30
    expected:
      eitc: 2647
    citations:
      - "§ 32(a)(2)(B): phaseout_percentage = 15.98%"
      - "Rev. Proc. 2022-38: threshold = $21,560"

  - name: "Phase-out: 2 children, $40000 income"
    description: "$6,604 - 21.06% × ($40,000 - $21,560) = $2,721"
    inputs:
      filing_status: single
      earned_income: 40000
      qualifying_children: 2
      age: 35
    expected:
      eitc: 2721
    citations:
      - "§ 32(a)(2)(B): phaseout_percentage = 21.06%"

  # ==========================================================================
  # JOINT RETURNS - Higher phaseout threshold
  # ==========================================================================

  - name: "Joint: 0 children, plateau"
    description: "Joint threshold $16,370 vs single $9,800"
    inputs:
      filing_status: joint
      earned_income: 15000
      qualifying_children: 0
      age: 40
    expected:
      eitc: 600
    citations:
      - "§ 32(b)(2)(B): joint bonus = $5,000 (indexed)"
      - "Rev. Proc. 2022-38: joint threshold = $16,370"

  - name: "Joint: 2 children, partial phase-out"
    description: "$6,604 - 21.06% × ($40,000 - $28,120) = $4,102"
    inputs:
      filing_status: joint
      earned_income: 40000
      qualifying_children: 2
      age: 35
    expected:
      eitc: 4102
    citations:
      - "Rev. Proc. 2022-38: joint threshold = $28,120"

  # ==========================================================================
  # COMPLETE PHASE-OUT - Credit = 0
  # ==========================================================================

  - name: "Fully phased out: 0 children, $18000"
    inputs:
      filing_status: single
      earned_income: 18000
      qualifying_children: 0
      age: 40
    expected:
      eitc: 0
    citations:
      - "Rev. Proc. 2022-38: complete phaseout at $17,640"

  - name: "Fully phased out: 1 child, $48000"
    inputs:
      filing_status: single
      earned_income: 48000
      qualifying_children: 1
      age: 30
    expected:
      eitc: 0
    citations:
      - "Rev. Proc. 2022-38: complete phaseout at $46,560"

  # ==========================================================================
  # ELIGIBILITY TESTS
  # ==========================================================================

  - name: "No earned income - ineligible"
    description: "Must have earned income per § 32(c)(2)"
    inputs:
      filing_status: single
      earned_income: 0
      qualifying_children: 2
      age: 35
    expected:
      eitc: 0
    citations:
      - "§ 32(c)(2): earned income required"

  - name: "Childless under age 25 - ineligible"
    description: "§ 32(c)(1)(A)(ii)(II): must be 25-64 without children"
    inputs:
      filing_status: single
      earned_income: 8000
      qualifying_children: 0
      age: 23
    expected:
      eitc: 0
    citations:
      - "§ 32(c)(1)(A)(ii)(II): age 25 minimum for childless"
    notes: |
      TAXSIM limitation: TAXSIM-35 does not enforce age eligibility rules.
      Use PolicyEngine for age eligibility validation.

  - name: "Childless age 25 - eligible"
    inputs:
      filing_status: single
      earned_income: 7000
      qualifying_children: 0
      age: 25
    expected:
      eitc: 535
    citations:
      - "§ 32(c)(1)(A)(ii)(II): age 25 is eligible"
