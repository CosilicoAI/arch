# Test cases for 26 USC § 32 (EITC)
# Tax Year 2024
# Parameters from Rev. Proc. 2023-34

test_cases:
  # ==========================================================================
  # PHASE-IN REGION TESTS - Credit grows as income increases
  # ==========================================================================

  - name: "Single, no children, $5000 earned income (phase-in)"
    description: "Credit = 7.65% of earned income"
    inputs:
      filing_status: single
      earned_income: 5000
      qualifying_children: 0
      investment_income: 0
    expected:
      eitc: 382  # 5000 * 0.0765 = 382.50
    citation: "26 USC § 32(b)(1)"

  - name: "Single, 1 child, $8000 earned income (phase-in)"
    description: "Credit = 34% of earned income"
    inputs:
      filing_status: single
      earned_income: 8000
      qualifying_children: 1
      investment_income: 0
    expected:
      eitc: 2720  # 8000 * 0.34 = 2720
    citation: "26 USC § 32(b)(1)"

  - name: "Single, 2 children, $10000 earned income (phase-in)"
    description: "Credit = 40% of earned income"
    inputs:
      filing_status: single
      earned_income: 10000
      qualifying_children: 2
      investment_income: 0
    expected:
      eitc: 4000  # 10000 * 0.40 = 4000
    citation: "26 USC § 32(b)(1)"

  - name: "Single, 3 children, $12000 earned income (phase-in)"
    description: "Credit = 45% of earned income"
    inputs:
      filing_status: single
      earned_income: 12000
      qualifying_children: 3
      investment_income: 0
    expected:
      eitc: 5400  # 12000 * 0.45 = 5400
    citation: "26 USC § 32(b)(1)"

  # ==========================================================================
  # PLATEAU REGION TESTS - Maximum credit (2024 Rev. Proc. values)
  # ==========================================================================

  - name: "Single, no children, max credit plateau"
    description: "Credit reaches maximum $632 for 2024"
    inputs:
      filing_status: single
      earned_income: 9000
      qualifying_children: 0
      investment_income: 0
    expected:
      eitc: 632  # Max for 0 children in 2024
    citation: "26 USC § 32(a); Rev. Proc. 2023-34"

  - name: "Single, 1 child, max credit plateau"
    description: "Credit at maximum $4,213 for 2024"
    inputs:
      filing_status: single
      earned_income: 15000
      qualifying_children: 1
      investment_income: 0
    expected:
      eitc: 4213  # Max for 1 child in 2024
    citation: "26 USC § 32(a); Rev. Proc. 2023-34"

  - name: "Single, 2 children, max credit plateau"
    description: "Credit at maximum $6,960 for 2024"
    inputs:
      filing_status: single
      earned_income: 18000
      qualifying_children: 2
      investment_income: 0
    expected:
      eitc: 6960  # Max for 2 children in 2024
    citation: "26 USC § 32(a); Rev. Proc. 2023-34"

  - name: "Single, 3+ children, max credit plateau"
    description: "Credit at maximum $7,830 for 2024"
    inputs:
      filing_status: single
      earned_income: 18000
      qualifying_children: 4  # Capped at 3 for rate purposes
      investment_income: 0
    expected:
      eitc: 7830  # Max for 3+ children in 2024
    citation: "26 USC § 32(a); Rev. Proc. 2023-34"

  # ==========================================================================
  # PHASE-OUT REGION TESTS - Credit decreases above threshold
  # Thresholds (single): $10,330 (0), $22,720 (1-3) per Rev. Proc. 2023-34
  # ==========================================================================

  - name: "Single, no children, partial phase-out"
    description: "Credit reduced by 7.65% of income above $10,330"
    inputs:
      filing_status: single
      earned_income: 12000
      qualifying_children: 0
      investment_income: 0
    expected:
      eitc: 504  # 632 - (12000 - 10330) * 0.0765 = 632 - 127.76 = 504
    citation: "26 USC § 32(a)(2)(B)"

  - name: "Single, 1 child, partial phase-out"
    description: "Credit reduced by 15.98% of income above $22,720"
    inputs:
      filing_status: single
      earned_income: 30000
      qualifying_children: 1
      investment_income: 0
    expected:
      eitc: 3050  # 4213 - (30000 - 22720) * 0.1598 = 4213 - 1163.34 = 3050
    citation: "26 USC § 32(a)(2)(B)"

  - name: "Single, 2 children, partial phase-out"
    description: "Credit reduced by 21.06% of income above $22,720"
    inputs:
      filing_status: single
      earned_income: 40000
      qualifying_children: 2
      investment_income: 0
    expected:
      eitc: 3320  # 6960 - (40000 - 22720) * 0.2106 = 6960 - 3639.17 = 3321
    citation: "26 USC § 32(a)(2)(B)"

  # ==========================================================================
  # JOINT RETURN TESTS - Higher phase-out thresholds
  # Joint thresholds: $17,250 (0), $29,640 (1-3) per Rev. Proc. 2023-34
  # ==========================================================================

  - name: "Joint, no children, in plateau (below phase-out)"
    description: "Joint filers get higher phase-out threshold"
    inputs:
      filing_status: joint
      earned_income: 15000
      qualifying_children: 0
      investment_income: 0
    expected:
      eitc: 632  # Still at max - below $17,250 threshold
    citation: "26 USC § 32(b)(2)(B)"

  - name: "Joint, 2 children, partial phase-out"
    description: "Phase-out starts at $29,640 for joint filers"
    inputs:
      filing_status: joint
      earned_income: 40000
      qualifying_children: 2
      investment_income: 0
    expected:
      eitc: 4778  # 6960 - (40000 - 29640) * 0.2106 = 6960 - 2181.82 = 4778
    citation: "26 USC § 32(b)(2)(B)"

  # ==========================================================================
  # COMPLETE PHASE-OUT TESTS - Credit reaches zero
  # ==========================================================================

  - name: "Single, no children, fully phased out"
    description: "Credit is zero when income exceeds phase-out end"
    inputs:
      filing_status: single
      earned_income: 19000
      qualifying_children: 0
      investment_income: 0
    expected:
      eitc: 0  # 632 - (19000 - 10330) * 0.0765 = negative -> 0
    citation: "26 USC § 32(a)(2)"

  - name: "Single, 1 child, fully phased out"
    description: "Income too high for any credit"
    inputs:
      filing_status: single
      earned_income: 50000
      qualifying_children: 1
      investment_income: 0
    expected:
      eitc: 0
    citation: "26 USC § 32(a)(2)"

  - name: "Single, 3 children, high income fully phased out"
    inputs:
      filing_status: single
      earned_income: 60000
      qualifying_children: 3
      investment_income: 0
    expected:
      eitc: 0
    citation: "26 USC § 32(a)(2)"

  # ==========================================================================
  # EDGE CASES & ELIGIBILITY
  # ==========================================================================

  - name: "Zero earned income - no credit"
    description: "Must have earned income to claim EITC"
    inputs:
      filing_status: single
      earned_income: 0
      qualifying_children: 2
      investment_income: 0
    expected:
      eitc: 0
    citation: "26 USC § 32(c)(2)"

  - name: "Investment income exceeds $11,600 limit - no credit"
    description: "Disqualified if investment income > $11,600"
    inputs:
      filing_status: single
      earned_income: 20000
      qualifying_children: 2
      investment_income: 15000
    expected:
      eitc: 0
    citation: "26 USC § 32(i)"

  - name: "Investment income at limit - credit allowed but AGI affects phaseout"
    description: "Investment income at $11,600 passes eligibility but adds to AGI"
    inputs:
      filing_status: single
      earned_income: 18000
      qualifying_children: 2
      investment_income: 11600
    expected:
      # Eligible (inv income <= 11600), but AGI = 18000 + 11600 = 29600
      # Credit = 6960 - (29600 - 22720) * 0.2106 = 6960 - 1449 = 5511
      eitc: 5511
    citation: "26 USC § 32(i), 32(a)(2)(B)"

  - name: "Childless worker under age 25 - no credit"
    description: "Childless workers must be 25-64 per § 32(c)(1)(A)(ii)(II)"
    inputs:
      filing_status: single
      earned_income: 8000
      qualifying_children: 0
      investment_income: 0
      age: 23
    expected:
      eitc: 0
    citation: "26 USC § 32(c)(1)(A)(ii)(II)"

  - name: "Childless worker age 25 - credit allowed"
    description: "Age 25 is minimum for childless EITC"
    inputs:
      filing_status: single
      earned_income: 8000
      qualifying_children: 0
      investment_income: 0
      age: 25
    expected:
      eitc: 612  # 8000 * 0.0765 = 612
    citation: "26 USC § 32(c)(1)(A)(ii)(II)"

  - name: "AGI higher than earned income - use AGI for phase-out"
    description: "Phase-out uses greater of earned income or AGI (requires explicit AGI input)"
    inputs:
      filing_status: single
      earned_income: 25000
      adjusted_gross_income: 35000  # Must be set explicitly by test harness
      qualifying_children: 1
      investment_income: 0
    expected:
      eitc: 2251  # 4213 - (35000 - 22720) * 0.1598 = 4213 - 1962.14 = 2251
    citation: "26 USC § 32(a)(2)(B)"
    notes: "Test harness must inject AGI at tax_unit level, not derive from income"
